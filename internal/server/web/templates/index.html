<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reminders</title>
    <link rel="icon" href="data:,">
    <link rel="stylesheet" href="/static/css/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="/static/js/theme.js"></script>
    <script>
        // Set theme immediately to prevent flash of wrong theme
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
        })();
    </script>
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="header-brand">
                    <h1 class="header-title">ðŸ”” Reminders</h1>
                </div>
                <div class="header-actions">
                    <a href="/calendar" class="btn btn-secondary btn-sm">ðŸ“… Calendar</a>
                    <button id="theme-toggle" class="btn btn-ghost btn-icon" onclick="toggleTheme()" aria-label="Toggle theme">ðŸŒ™</button>
                </div>
            </div>
        </header>

        <main id="main-content">
            <!-- Quick Create Section -->
            <section class="quick-create-section">
                <div class="section-header">
                    <h2>Create Reminder</h2>
                </div>
                
                <div class="quick-create-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quick-message" class="form-label">Message *</label>
                            <input type="text" id="quick-message" class="form-input" placeholder="Enter reminder message" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-datetime" class="form-label">Date & Time *</label>
                            <input type="datetime-local" id="quick-datetime" class="form-input" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="quick-follow-up" class="form-label">Follow-up Duration</label>
                            <input type="text" id="quick-follow-up" class="form-input" placeholder="e.g., P1D (daily)">
                        </div>
                        
                        <div class="form-group">
                            <label for="quick-max-follow-ups" class="form-label">Max Follow-ups</label>
                            <input type="number" id="quick-max-follow-ups" class="form-input" value="-1" min="-1">
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button id="quick-create-btn" class="btn btn-primary btn-lg w-full" onclick="createReminder()">
                            <span>âž•</span> Create Reminder
                        </button>
                    </div>
                </div>
            </section>

            <!-- Upcoming Reminders Section -->
            <section class="reminders-section">
                <div class="section-header">
                    <h2>Upcoming Reminders</h2>
                    <span class="reminder-count" id="upcoming-count">(0)</span>
                </div>
                
                <div id="upcoming-reminders" class="reminders-list">
                    <div class="empty-state">
                        <p class="empty-state-text">No upcoming reminders. Create one to get started!</p>
                    </div>
                </div>
            </section>

            <!-- Past Reminders Section -->
            <section class="reminders-section past-section">
                <div class="section-header">
                    <h2>Past Reminders</h2>
                    <span class="reminder-count" id="past-count">(0)</span>
                </div>
                
                <div id="past-reminders" class="reminders-list">
                    <div class="empty-state">
                        <p class="empty-state-text">No past reminders yet.</p>
                    </div>
                </div>
            </section>
        </main>
        
        <!-- Floating Action Button (Mobile) -->
        <button id="mobile-fab" class="fab" onclick="scrollToQuickCreate()" aria-label="Create reminder">
            <span>âž•</span>
        </button>
    </div>

    <!-- Edit Reminder Modal -->
    <div id="edit-modal" class="modal" role="dialog" aria-labelledby="edit-modal-title" aria-modal="true">
        <div class="modal-overlay" onclick="closeEditModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="edit-modal-title">Edit Reminder</h2>
                <button class="modal-close" onclick="closeEditModal()" aria-label="Close modal">&times;</button>
            </div>

            <form id="edit-form" onsubmit="updateReminder(event)">
                <input type="hidden" id="edit-id">

                <div class="form-group">
                    <label for="edit-message" class="form-label">Message *</label>
                    <textarea id="edit-message" class="form-input form-textarea" rows="3" required></textarea>
                </div>

                <div class="form-group">
                    <label for="edit-datetime" class="form-label">Date & Time *</label>
                    <input type="datetime-local" id="edit-datetime" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="edit-follow-up" class="form-label">Follow-up Duration</label>
                    <input type="text" id="edit-follow-up" class="form-input" placeholder="e.g., P1D (daily)">
                </div>

                <div class="form-group">
                    <label for="edit-max-follow-ups" class="form-label">Max Follow-ups</label>
                    <input type="number" id="edit-max-follow-ups" class="form-input" value="-1" min="-1">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">Cancel</button>
                    <button id="update-btn" type="submit" class="btn btn-primary">Update Reminder</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

    <script src="/static/js/app.js"></script>
    <script>
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            initFloatingLabels();
            loadReminders();
            // Set default datetime to 1 hour from now (always in the future)
            const now = new Date();
            now.setHours(now.getHours() + 1);
            now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
            document.getElementById('quick-datetime').value = now.toISOString().slice(0, 16);
            
            // Check for editId parameter from calendar redirect
            const urlParams = new URLSearchParams(window.location.search);
            const editId = urlParams.get('editId');
            if (editId) {
                // Open edit modal for this reminder
                setTimeout(() => {
                    openEditModal(editId);
                }, 500);
                // Remove the editId parameter from URL
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });
    </script>
</body>
</html>
